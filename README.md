# PerceptArtifactAnalysis

Code for the IEEE NER 2025 paper:<br>
**Artifact Identification and Mitigation Strategies for Longitudinal Neural Data Collection Onboard the Medtronic Percept DBS Device**<br>
[[PDF]](PerceptArtifacts_NER2025_V2_6.pdf)<br>
*Rick R. Hanish†, Thomas P. Kutcher, Tomasz M. Fraczek, Raphael A. Bechtold, Jeffrey Zhou, Saipravallika Chamarthi, Gabriel Reyes, Mark Libowitz, Ben Shofty, Brian J. Mickey, Brent M. Kious, Wayne K. Goodman, Ankit B. Patel, Sameer A. Sheth, Jeffrey A. Herron, Nicole R. Provenza‡*<br>
Rice University, Baylor College of Medicine, University of Washington, and University of Utah<br>
*†E-mail: `rick.hanish@rice.edu`<br>*
*‡E-mail: `nicole.provenza@bcm.edu`*

## Overview
This repository contains code for identifying and mitigating overvoltage artifacts in low-frequency longitudinal local field potential (LFP) power data collected using the Medtronic Percept DBS device. These artifacts arise when the recorded neural signal exceeds the device's maximum sensing range, leading to the insertion of a flag value that distorts downstream analyses.

In our paper, we:
- Characterize overvoltage events across 23 OCD patients implanted with either Medtronic 3387 or Medtronic Sensight leads.
- Quantify the prevalence of overvoltage artifacts and their association with physical activity data from the Oura Ring.
- Propose and evaluate three artifact correction strategies:
    1. Thresholding
    2. Thresholding + interpolation
    3. Overvoltage event removal (OvER) – a principled method that re-averages valid LFP power measurements after removing those contaminated by an overvoltage.

We demonstrate that OvER most effectively preserves the underlying neural signal structure, including circadian rhythms.

## Getting Started
### Prerequisites
- Python 3.11 (other Python versions may work but have not been tested)
- Conda (recommended)

### Setup
```bash
git clone https://github.com/ProvenzaLab/PerceptArtifactAnalysis.git
cd PerceptArtifactAnalysis
conda create -n artifact_analysis_env python=3.11
conda activate artifact_analysis_env
pip install -r requirements.txt
```

### Key Methods
The primary file in this repository is `artifact_analysis.ipynb`. It first reads in data about patients from the `patient_info.yaml` file. The complete yaml file is not included in the repository because it contains sensitive patient information, but a placeholder containing the following example is included. Its contents may be filled in and its structure adapted to different datasets:
```
patients:
  - id: B001
    data_path: "/Path/To/B001/LFP"
    dbs_on_date: "yyyy-mm-dd"
  - id: B002
    data_path: "/Path/To/B002/LFP"
    dbs_on_date: "yyyy-mm-dd"
    ...
```

Then, it loads the JSON files containing stimulation and LFP power data in BrainSense Timeline format into a DataFrame. These JSON files are generated by and downloaded directly from the Percept device.

The dataset is processed to ensure that data from each patient are in a consistent and accurate format, duplicate data samples are removed, and the DataFrame contains all the necessary information to correct for overvoltages.

Code for the overvoltage correction methods is written in `artifact_correct.py`. Note that this file only contains code for the thresholding and OvER methods, and interpolation of missing data is completed in the notebook.

After quantifying the frequency of overvoltage events in each patient and the strength of the circadian rhythm resulting from each correction method, we read in the Oura data and sync it with the neural data. Not every neural sample has associated Oura data (i.e., if the patient was not wearing their ring), and not every piece of data collected by the Oura ring has an associated neural sample (i.e., their neural data got overwritten by more recent data before being downloaded). We take the intersection of the two datasets based on timestamps under the assumption that time drift from network time for each is negligible compared to the low sampling frequency. For much of our analysis, we compile a list of all MET values that occurred during a single 10-minute LFP interval and calculate the maximum of that list.

Code for recreating each of the paper's figures is included.